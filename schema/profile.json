{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Espresso Profile Schema",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "id": {
      "type": "string",
      "format": "uuid"
    },
    "label": {
      "type": "string"
    },
    "type": {
      "type": "string",
      "enum": [
        "standard",
        "pro"
      ]
    },
    "description": {
      "type": "string"
    },
    "temperature": {
      "type": "number"
    },
    "favorite": {
      "type": "boolean"
    },
    "selected": {
      "type": "boolean"
    },
    "phases": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "name": {
            "type": "string"
          },
          "phase": {
            "type": "string",
            "enum": [
              "preinfusion",
              "brew"
            ]
          },
          "valve": {
            "type": "integer",
            "enum": [
              0,
              1
            ]
          },
          "duration": {
            "type": "number",
            "minimum": 0
          },
          "transition": {
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "enum": [
                  "instant",
                  "linear",
                  "ease-in",
                  "ease-out",
                  "ease-in-out"
                ]
              },
              "duration": {
                "type": "number"
              },
              "adaptive": {
                "type": "integer",
                "enum": [
                  0,
                  1
                ]
              }
            },
            "required": [
              "type",
              "duration"
            ]
          },
          "temperature": {
            "type": "number",
            "description": "When this is set it will override the temperature of the profile while running",
            "minimum": 0,
            "maximum": 165
          },
          "pump": {
            "oneOf": [
              {
                "type": "number",
                "enum": [
                  0,
                  1
                ]
              },
              {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                  "target": {
                    "type": "string",
                    "enum": [
                      "pressure",
                      "flow"
                    ]
                  },
                  "pressure": {
                    "type": "number",
                    "description": "The target or limit pressure of the phase. If it's set to -1, it will use the current pressure at the start of the phase",
                    "minimum": -1
                  },
                  "flow": {
                    "type": "number",
                    "description": "The target or limit flow of the phase. If it's set to -1, it will use the current flow at the start of the phase",
                    "minimum": -1
                  }
                },
                "required": [
                  "target",
                  "pressure",
                  "flow"
                ]
              }
            ]
          },
          "targets": {
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "type": {
                  "type": "string",
                  "enum": [
                    "volumetric",
                    "pressure",
                    "flow",
                    "pumped"
                  ]
                },
                "operator": {
                  "type": "string",
                  "description": "Whether the target should hit if greater than or less than. Default is gt",
                  "enum": [
                    "gte",
                    "lte"
                  ],
                  "default": "gte"
                },
                "value": {
                  "type": "number",
                  "minimum": 0
                }
              },
              "required": [
                "type",
                "value"
              ]
            }
          }
        },
        "required": [
          "name",
          "phase",
          "valve",
          "duration",
          "pump"
        ]
      }
    }
  },
  "required": [
    "id",
    "label",
    "type",
    "description",
    "phases"
  ]
}
